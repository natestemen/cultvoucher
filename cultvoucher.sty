% Bibliography formatting

\usepackage[
    sorting      = ydnt,
    bibstyle     = authoryear-comp,
    maxnames     = 20,
    giveninits   = true,
    uniquename   = init,
    dashed       = false,
    doi          = false,
    isbn         = false,
    backend      = bibtex,
    defernumbers = true]{biblatex}


%\DeclareFieldFormat{url}{\url{#1}}
\DeclareFieldFormat[article]{pages}{#1}
\DeclareFieldFormat[inproceedings]{pages}{\lowercase{pp.}#1}
\DeclareFieldFormat[incollection]{pages}{\lowercase{pp.}#1}
\DeclareFieldFormat[article]{volume}{#1}
\DeclareFieldFormat[article]{number}{\mkbibparens{#1}}
\DeclareFieldFormat[article]{title}{\MakeCapital{#1}}
%\DeclareFieldFormat[article]{url}{}
\DeclareFieldFormat[inproceedings]{title}{#1}
\DeclareFieldFormat{shorthandwidth}{#1}
\DeclareFieldFormat{extrayear}{}
\DeclareFieldFormat[misc]{howpublished}{\textit{#1}}
\DeclareFieldFormat[misc]{title}{#1}

% No dot before number of articles
% \usepackage{xpatch}
% \xpatchbibmacro{volume+number+eid}{\setunit*{\adddot}}{}{}{}

% Remove In: for an article.
\renewbibmacro{in:}{
    \ifentrytype{article}{}{
        \printtext{\bibstring{in}\intitlepunct}
    }
}

% Bibliography categories
\newcommand{\makebibcategory}[2]{\DeclareBibliographyCategory{#1}
    \defbibheading{#1}{
        \titlespacing{\subsection}{0pt}{\parskip}{-0.5\parskip}
        \subsection*{\textbf{#2}}
    }
}

\makebibcategory{books}{Books}
\makebibcategory{other}{Other Research Papers}
\makebibcategory{papers}{Refereed Research Papers}
\makebibcategory{presentations}{Contributed Conference Presentations}
\makebibcategory{invited}{Invited Conference Presentations}
\makebibcategory{seminars}{Invited Seminars}
\makebibcategory{chapters}{Book chapters}
\makebibcategory{conferences}{Conference Proceedings}
\makebibcategory{techreports}{Unpublished working papers}
\makebibcategory{bookreviews}{Book reviews}
\makebibcategory{editorials}{Editorials}
\makebibcategory{phd}{PhD thesis}
\makebibcategory{subpapers}{Submitted Papers}
\makebibcategory{curpapers}{Current Papers}

\setlength{\bibitemsep}{2.5pt}
\setlength{\bibhang}{.8cm}

\renewcommand*{\bibitem}{\addtocounter{papers}{1}\item \mbox{}\hskip-0.85cm\hbox to 0.85cm{\hfill\arabic{papers}.~~}}
\defbibenvironment{bibliography}
{\list{}
 {\setlength{\leftmargin}{\bibhang}%
  \setlength{\itemsep}{\bibitemsep}%
  \setlength{\parsep}{\bibparsep}}}
{\endlist}
{\bibitem}


\newcommand{\printbib}[1]{
    \printbibliography[category=#1,heading=#1]
    \lastref{sumpapers}
}

% Counters for keeping track of papers
\newcounter{papers}\setcounter{papers}{0}
\newcounter{sumpapers}\setcounter{sumpapers}{0}

\newcommand{\lastref}[1]{\addtocounter{#1}{\value{papers}}\setcounter{papers}{0}}

% Add all papers in the bib file.
\nocite{*}
